<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Refurbishment | AutoGaard Workshop</title>
    <link rel="stylesheet" href="../css/theme.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/components.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: 'var(--primary)', 'primary-dark': 'var(--primary-dark)', 'bg-body': 'var(--bg-body)',
                        'bg-surface': 'var(--bg-surface)', 'bg-surface-elevated': 'var(--bg-surface-elevated)',
                        'text-primary': 'var(--text-primary)', 'text-secondary': 'var(--text-secondary)', 'border-color': 'var(--border-color)',
                    },
                    fontFamily: { bebas: ['Bebas Neue', 'sans-serif'], display: ['Rajdhani', 'sans-serif'], body: ['Inter', 'sans-serif'], }
                }
            }
        }
    </script>
    <style>
        html,
        body {
            background-color: var(--bg-body) !important;
            margin: 0;
            padding: 0;
        }

        .page-wrapper {
            background-color: var(--bg-body);
        }

        .hub-card {
            border: 1px solid var(--border-color);
            background: var(--bg-surface);
            transition: all 0.3s;
            cursor: pointer;
        }

        .hub-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .hub-card .icon-box {
            transition: all 0.3s;
        }

        .hub-card:hover .icon-box {
            background: var(--primary);
            color: white;
        }
    </style>
    <script src="../js/theme.js"></script>
    <script src="js/garage-data.js"></script>
    <script src="js/registration-services.js"></script>
</head>

<body class="bg-bg-body text-text-primary">
    <div class="page-wrapper container pb-32">
        <header class="app-header">
            <button onclick="window.history.back()" class="p-2 -ml-2"><span
                    class="material-symbols-outlined text-text-primary">arrow_back</span></button>
            <h1 class="header-title uppercase tracking-widest">Refurbishment</h1>
            <div class="w-10"></div>
        </header>

        <main class="animate-fade-in px-gutter">
            <!-- VEHICLE CONTEXT -->
            <div id="vehicle-card" class="mb-6 mt-4"></div>

            <p class="text-[10px] font-black uppercase tracking-[0.2em] text-primary/60 mb-4 px-1">Repair & Detailing
            </p>

            <div class="grid grid-cols-1 gap-4">
                <!-- Paint Calculator -->
                <div onclick="openCalculator('paint')"
                    class="hub-card rounded-3xl p-5 flex items-center gap-4 cursor-pointer">
                    <div
                        class="icon-box w-12 h-12 rounded-2xl bg-primary/10 flex items-center justify-center text-primary">
                        <span class="material-symbols-outlined">calculate</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-sm font-bold tracking-widest uppercase">Quote Builder</h3>
                        <p class="text-[8px] text-text-secondary uppercase tracking-widest leading-tight">Get exact
                            pricing for paint & detailing.</p>
                    </div>
                    <span class="material-symbols-outlined text-text-secondary">chevron_right</span>
                </div>

                <!-- Repaint -->
                <div onclick="navigateTo('repaint')" class="hub-card rounded-3xl p-5 flex items-center gap-4">
                    <div
                        class="icon-box w-12 h-12 rounded-2xl bg-primary/10 flex items-center justify-center text-primary">
                        <span class="material-symbols-outlined">palette</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-sm font-bold tracking-widest uppercase">Custom Repaint</h3>
                        <p class="text-[8px] text-text-secondary uppercase tracking-widest leading-tight">Baking oven
                            finish & computer-matched hues.</p>
                        <p class="text-[7px] text-primary font-bold uppercase mt-1">Free AI Color Preview</p>
                    </div>
                    <span class="material-symbols-outlined text-text-secondary">chevron_right</span>
                </div>

                <!-- Deep Clean -->
                <div onclick="navigateTo('deep-clean')" class="hub-card rounded-3xl p-5 flex items-center gap-4">
                    <div
                        class="icon-box w-12 h-12 rounded-2xl bg-primary/10 flex items-center justify-center text-primary">
                        <span class="material-symbols-outlined">cleaning_services</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-sm font-bold tracking-widest uppercase">Deep Clean</h3>
                        <p class="text-[8px] text-text-secondary uppercase tracking-widest leading-tight">Steam
                            detailing & anti-bacterial fogging.</p>
                    </div>
                    <span class="material-symbols-outlined text-text-secondary">chevron_right</span>
                </div>
            </div>

            <!-- BUSINESS MODEL: REFURBISHMENT TRANSPARENCY -->
            <div class="mt-10 space-y-8">
                <!-- PRICING ARCHITECTURE -->
                <section>
                    <h4 class="text-[10px] font-black uppercase tracking-[0.2em] text-primary mb-4 px-1">How We Price
                    </h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-bg-surface-elevated p-4 rounded-2xl border border-white/5">
                            <p class="text-[8px] font-black uppercase text-text-secondary mb-1">Full Repaint</p>
                            <p class="text-xs font-bold text-text-primary">From ₦350,000</p>
                            <p class="text-[7px] text-text-secondary uppercase mt-2">Durable high-gloss finish with
                                2-year warranty.</p>
                        </div>
                        <div class="bg-bg-surface-elevated p-4 rounded-2xl border border-white/5">
                            <p class="text-[8px] font-black uppercase text-text-secondary mb-1">Detailing</p>
                            <p class="text-xs font-bold text-text-primary">Flat ₦45,000</p>
                            <p class="text-[7px] text-text-secondary uppercase mt-2">Complete interior & exterior deep
                                restoration.</p>
                        </div>
                    </div>
                </section>

                <!-- SERVICE PROTOCOL -->
                <section>
                    <h4 class="text-[10px] font-black uppercase tracking-[0.2em] text-primary mb-4 px-1">Aesthetic
                        Protocol</h4>
                    <div class="space-y-4">
                        <div class="flex gap-4">
                            <div
                                class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-xs">
                                1</div>
                            <div class="flex-1">
                                <p class="text-[9px] font-bold uppercase tracking-widest">Aesthetic Appraisal</p>
                                <p class="text-[8px] text-text-secondary uppercase mt-1">Evaluation of body integrity
                                    and surface prep requirements.</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div
                                class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-xs">
                                2</div>
                            <div class="flex-1">
                                <p class="text-[9px] font-bold uppercase tracking-widest">Digital Simulation</p>
                                <p class="text-[8px] text-text-secondary uppercase mt-1">Our AI renders your car in the
                                    new color for final approval.</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div
                                class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-xs">
                                3</div>
                            <div class="flex-1">
                                <p class="text-[9px] font-bold uppercase tracking-widest">Quality Audit</p>
                                <p class="text-[8px] text-text-secondary uppercase mt-1">Multi-stage paint thickness
                                    audit and finish inspection.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <nav class="bottom-nav">
            <a href="../dashboard.html" class="nav-item"><span class="material-symbols-outlined">grid_view</span><span
                    class="nav-label">Home</span></a>
            <a href="../fleet.html" class="nav-item"><span class="material-symbols-outlined">explore</span><span
                    class="nav-label">Fleet</span></a>
            <a href="../garage.html" class="nav-item active"><span
                    class="material-symbols-outlined">directions_car</span><span class="nav-label">Garage</span></a>
            <a href="../inquiries.html" class="nav-item"><span class="material-symbols-outlined">forum</span><span
                    class="nav-label">Concierge</span></a>
            <a href="../settings.html" class="nav-item"><span class="material-symbols-outlined">tune</span><span
                    class="nav-label">Settings</span></a>
        </nav>
    </div>

    <!-- CALCULATOR MODAL -->
    <div id="calc-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-md" onclick="closeCalculator()"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-bg-surface rounded-t-[3rem] p-8 pb-12 border-t border-white/10 max-h-[90vh] overflow-y-auto translate-y-full transition-transform duration-500 ease-out"
            id="modal-content">
            <div class="w-12 h-1.5 bg-white/10 rounded-full mx-auto mb-8"></div>

            <h2 class="text-2xl font-[var(--font-bebas)] tracking-[0.2em] mb-2 uppercase">Refurbish Quote Builder</h2>
            <p class="text-[10px] text-text-secondary uppercase tracking-widest mb-8">Select finish options for your
                ${activeVehicle?.make || 'Vehicle'}.</p>

            <div class="space-y-6">
                <div>
                    <label
                        class="text-[10px] font-bold uppercase tracking-widest text-text-secondary mb-2 block">Vehicle
                        Class</label>
                    <select id="class-input"
                        class="w-full bg-bg-body border border-border-color rounded-2xl p-4 text-sm focus:border-primary outline-none transition-all appearance-none">
                        <option value="sedan">Sedan / Hatchback</option>
                        <option value="suv">SUV / Crossover</option>
                        <option value="truck">Truck / Large SUV</option>
                    </select>
                </div>

                <div>
                    <label class="text-[10px] font-bold uppercase tracking-widest text-text-secondary mb-2 block">Paint
                        Tier</label>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="setTier('standard')" id="tier-standard"
                            class="tier-btn p-4 rounded-2xl border border-primary text-[10px] font-black uppercase tracking-widest bg-primary/10 text-primary">Standard
                            Gloss</button>
                        <button onclick="setTier('premium')" id="tier-premium"
                            class="tier-btn p-4 rounded-2xl border border-white/5 text-[10px] font-black uppercase tracking-widest text-text-secondary">Premium
                            Hue</button>
                    </div>
                </div>

                <div id="results-area" class="space-y-4 pt-6 mt-6 border-t border-white/5">
                    <div class="bg-bg-body rounded-2xl p-6 border border-white/5 space-y-4">
                        <div
                            class="flex justify-between items-center text-[10px] uppercase tracking-widest text-text-secondary">
                            <span>Base Workshop Cost</span>
                            <span id="res-base" class="font-bold text-text-primary">₦0</span>
                        </div>
                        <div
                            class="flex justify-between items-center text-[10px] uppercase tracking-widest text-primary font-bold">
                            <span>AutoGaard Quality Assurance (15%)</span>
                            <span id="res-comm" class="font-bold">₦0</span>
                        </div>
                        <div class="h-px bg-white/5"></div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs uppercase tracking-[0.2em] font-black text-text-primary">Total
                                Estimate</span>
                            <span id="res-total"
                                class="text-xl font-[var(--font-bebas)] tracking-widest text-primary">₦0</span>
                        </div>
                    </div>

                    <button onclick="saveAndBook()"
                        class="w-full py-4 bg-primary text-white rounded-2xl text-[10px] font-bold uppercase tracking-widest hover:brightness-110 transition-all">
                        Secure Workshop Slot
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let activeVehicle = null;
        let selectedTier = 'standard';
        let lastCalculation = null;

        function init() {
            activeVehicle = GarageData.getActiveVehicle();
            if (!activeVehicle) {
                window.location.href = 'select-vehicle.html?service=refurbishment-hub';
                return;
            }
            RegistrationServices.renderVehicleCard(activeVehicle, 'vehicle-card');

            // Auto-select class based on vehicle logic (simplified for MVP)
            const vClass = activeVehicle.model.toLowerCase().includes('rx') || activeVehicle.model.toLowerCase().includes('rav') ? 'suv' : 'sedan';
            document.getElementById('class-input').value = vClass;
            runCalculation();
        }

        function navigateTo(service) {
            window.location.href = `${service}.html?vid=${activeVehicle.id}`;
        }

        function openCalculator() {
            const modal = document.getElementById('calc-modal');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');
            setTimeout(() => content.classList.remove('translate-y-full'), 10);
        }

        function closeCalculator() {
            const content = document.getElementById('modal-content');
            content.classList.add('translate-y-full');
            setTimeout(() => document.getElementById('calc-modal').classList.add('hidden'), 500);
        }

        function setTier(tier) {
            selectedTier = tier;
            document.querySelectorAll('.tier-btn').forEach(b => {
                b.classList.remove('border-primary', 'bg-primary/10', 'text-primary');
                b.classList.add('border-white/5', 'text-text-secondary');
            });
            document.getElementById(`tier-${tier}`).classList.replace('border-white/5', 'border-primary');
            document.getElementById(`tier-${tier}`).classList.add('bg-primary/10', 'text-primary');
            runCalculation();
        }

        function runCalculation() {
            const vClass = document.getElementById('class-input').value;
            const res = GarageData.Calculators.calculatePaint(vClass, selectedTier);
            lastCalculation = res;

            document.getElementById('res-base').textContent = GarageData.formatCurrency(res.base);
            document.getElementById('res-comm').textContent = GarageData.formatCurrency(res.commission);
            document.getElementById('res-total').textContent = GarageData.formatCurrency(res.total);
        }

        document.getElementById('class-input').onchange = runCalculation;

        function saveAndBook() {
            if (!lastCalculation) return;
            GarageData.createServiceRecord({
                vehicleId: activeVehicle.id,
                type: 'repaint',
                title: 'Custom Repaint Service',
                invoiceTotal: lastCalculation.total,
                partnerName: 'AutoCraft Painting Terminal',
                details: { tier: selectedTier, vehicleClass: document.getElementById('class-input').value },
                lineItems: [
                    { name: 'Baking Oven Paint Job', price: lastCalculation.base },
                    { name: 'AutoGaard Management Fee', price: lastCalculation.commission }
                ]
            });
            alert('Request Sent to manager!');
            window.location.href = '../dashboard.html';
        }

        init();
    </script>
</body>

</html>
