<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Submit Paint Request | AutoGaard Workshop</title>

    <!-- CSS SYSTEM -->
    <link rel="stylesheet" href="../css/theme.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/components.css">

    <!-- Tailwind CDN + Config -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: 'var(--primary)',
                        'primary-dark': 'var(--primary-dark)',
                        'bg-body': 'var(--bg-body)',
                        'bg-surface': 'var(--bg-surface)',
                        'bg-surface-elevated': 'var(--bg-surface-elevated)',
                        'text-primary': 'var(--text-primary)',
                        'text-secondary': 'var(--text-secondary)',
                        'border-color': 'var(--border-color)',
                    },
                    fontFamily: {
                        bebas: ['Bebas Neue', 'sans-serif'],
                        display: ['Rajdhani', 'sans-serif'],
                        body: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <script src="../js/theme.js"></script>
    <script src="js/garage-data.js"></script>

    <style>
        /* Success Modal */
        .success-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .success-modal.active {
            display: flex;
        }

        .success-content {
            background: var(--bg-surface);
            border: 1px solid var(--primary);
            border-radius: 2rem;
            max-width: 500px;
            width: 100%;
            overflow: hidden;
            animation: successSlideUp 0.5s ease-out;
        }

        @keyframes successSlideUp {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            animation: successPulse 1s ease-in-out infinite;
        }

        @keyframes successPulse {

            0%,
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(var(--primary-rgb), 0.7);
            }

            50% {
                transform: scale(1.05);
                box-shadow: 0 0 0 20px rgba(var(--primary-rgb), 0);
            }
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--primary);
            animation: confettiFall 3s ease-out forwards;
        }

        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .workflow-step {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--bg-body);
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
        }

        .workflow-step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary)/10;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.875rem;
            flex-shrink: 0;
        }

        .terms-box {
            max-height: 200px;
            overflow-y: auto;
            padding: 1rem;
            background: var(--bg-body);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            font-size: 0.75rem;
            line-height: 1.6;
        }

        .terms-box::-webkit-scrollbar {
            width: 6px;
        }

        .terms-box::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }
    </style>
</head>

<body class="bg-bg-body text-text-primary">

    <div class="page-wrapper container pb-32">

        <!-- HEADER -->
        <header class="app-header">
            <button onclick="window.history.back()" class="p-2 -ml-2">
                <span class="material-symbols-outlined text-text-primary">arrow_back</span>
            </button>
            <h1 class="header-title uppercase tracking-widest">Submit Request</h1>
            <div class="w-10"></div>
        </header>

        <main class="animate-fade-in px-gutter">

            <!-- PROGRESS INDICATOR -->
            <div class="flex items-center justify-center gap-2 mb-6 mt-4">
                <div class="flex items-center gap-2">
                    <div
                        class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center text-xs font-bold">
                        ✓
                    </div>
                    <span class="text-[9px] uppercase tracking-widest text-text-secondary">Configure</span>
                </div>
                <div class="w-12 h-0.5 bg-primary"></div>
                <div class="flex items-center gap-2">
                    <div
                        class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center text-xs font-bold">
                        ✓
                    </div>
                    <span class="text-[9px] uppercase tracking-widest text-text-secondary">Review</span>
                </div>
                <div class="w-12 h-0.5 bg-primary"></div>
                <div class="flex items-center gap-2">
                    <div
                        class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center text-xs font-bold">
                        3
                    </div>
                    <span class="text-[9px] uppercase tracking-widest text-primary font-bold">Submit</span>
                </div>
            </div>

            <!-- FINAL SUMMARY -->
            <div class="bg-gradient-to-br from-primary/10 to-primary/5 border border-primary/20 rounded-2xl p-5 mb-6">
                <div class="flex items-center gap-3 mb-4">
                    <span class="material-symbols-outlined text-primary text-3xl">palette</span>
                    <div>
                        <h2 class="text-lg font-[var(--font-bebas)] tracking-widest uppercase">Full Vehicle Repaint</h2>
                        <p class="text-[9px] text-text-secondary uppercase tracking-widest" id="sla-display">-</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-bg-surface/50 rounded-xl p-3">
                        <p class="text-[8px] font-black uppercase tracking-widest text-text-secondary mb-1">Paint Type
                        </p>
                        <p class="text-xs font-bold" id="paint-type-summary">-</p>
                    </div>
                    <div class="bg-bg-surface/50 rounded-xl p-3">
                        <p class="text-[8px] font-black uppercase tracking-widest text-text-secondary mb-1">Service
                            Level</p>
                        <p class="text-xs font-bold" id="sla-summary">-</p>
                    </div>
                    <div class="bg-bg-surface/50 rounded-xl p-3 col-span-2">
                        <p class="text-[8px] font-black uppercase tracking-widest text-text-secondary mb-1">Estimated
                            Price</p>
                        <p class="text-2xl font-bold text-primary" id="price-summary">₦0</p>
                    </div>
                </div>
            </div>

            <!-- WORKFLOW EXPLANATION -->
            <div class="bg-bg-surface border border-border-color rounded-2xl p-5 mb-6">
                <h3 class="text-sm font-black uppercase tracking-widest mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary">info</span>
                    What Happens Next?
                </h3>

                <div class="space-y-2">
                    <div class="workflow-step">
                        <div class="workflow-step-number">1</div>
                        <div>
                            <p class="text-xs font-bold mb-1">manager Review</p>
                            <p class="text-[9px] text-text-secondary">Your request will be reviewed within 24-48 hours
                            </p>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <div class="workflow-step-number">2</div>
                        <div>
                            <p class="text-xs font-bold mb-1">Partner Assignment</p>
                            <p class="text-[9px] text-text-secondary">We'll assign a verified paint shop partner</p>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <div class="workflow-step-number">3</div>
                        <div>
                            <p class="text-xs font-bold mb-1">Quote Provided</p>
                            <p class="text-[9px] text-text-secondary">Partner will provide final pricing and timeline
                            </p>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <div class="workflow-step-number">4</div>
                        <div>
                            <p class="text-xs font-bold mb-1">Your Approval</p>
                            <p class="text-[9px] text-text-secondary">Review and approve/reject the quote</p>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <div class="workflow-step-number">5</div>
                        <div>
                            <p class="text-xs font-bold mb-1">Contract & Payment</p>
                            <p class="text-[9px] text-text-secondary">Digital signature and deposit payment</p>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <div class="workflow-step-number">6</div>
                        <div>
                            <p class="text-xs font-bold mb-1">Service Execution</p>
                            <p class="text-[9px] text-text-secondary">Partner completes the work with progress updates
                            </p>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <div class="workflow-step-number">7</div>
                        <div>
                            <p class="text-xs font-bold mb-1">Quality Check</p>
                            <p class="text-[9px] text-text-secondary">Final inspection before delivery</p>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <div class="workflow-step-number">8</div>
                        <div>
                            <p class="text-xs font-bold mb-1">Completion</p>
                            <p class="text-[9px] text-text-secondary">Vehicle delivered and you verify the work</p>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <div class="workflow-step-number">9</div>
                        <div>
                            <p class="text-xs font-bold mb-1">Feedback</p>
                            <p class="text-[9px] text-text-secondary">Rate your experience and provide feedback</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TERMS & CONDITIONS -->
            <div class="bg-bg-surface border border-border-color rounded-2xl p-5 mb-6">
                <h3 class="text-sm font-black uppercase tracking-widest mb-3">Terms & Conditions</h3>
                <div class="terms-box">
                    <p class="mb-3">By submitting this request, you agree to the following:</p>

                    <p class="font-bold mb-2">1. Pricing</p>
                    <p class="mb-3">The estimated price shown is indicative only. Final pricing will be provided by the
                        assigned partner and may vary based on vehicle condition, material costs, and other factors.</p>

                    <p class="font-bold mb-2">2. Timeline</p>
                    <p class="mb-3">Service Level Agreements (SLAs) are estimates. Actual completion time may vary due
                        to parts availability, weather conditions, or unforeseen complications.</p>

                    <p class="font-bold mb-2">3. Payment</p>
                    <p class="mb-3">A deposit (typically 30-50%) is required before work begins. Full payment is due
                        upon completion and your verification.</p>

                    <p class="font-bold mb-2">4. Cancellation</p>
                    <p class="mb-3">You may cancel your request before partner assignment at no cost. After assignment,
                        cancellation fees may apply.</p>

                    <p class="font-bold mb-2">5. Warranty</p>
                    <p class="mb-3">All work is covered by the partner's warranty. Warranty terms will be specified in
                        the final quote.</p>

                    <p class="font-bold mb-2">6. Quality Assurance</p>
                    <p class="mb-3">AutoGaard verifies all partners but is not directly responsible for service
                        execution. Any disputes will be mediated by our team.</p>
                </div>

                <label class="flex items-start gap-3 mt-4 cursor-pointer">
                    <input type="checkbox" id="terms-checkbox" class="mt-1">
                    <span class="text-[10px] text-text-secondary leading-relaxed">
                        I have read and agree to the terms and conditions above. I understand that this is a service
                        request and not a confirmed booking.
                    </span>
                </label>
            </div>

            <!-- ACTION BUTTONS -->
            <div class="flex gap-3">
                <button onclick="window.history.back()"
                    class="flex-1 py-4 bg-bg-surface border border-border-color rounded-xl text-[11px] font-black uppercase tracking-widest hover:border-primary transition-all">
                    Back to Review
                </button>
                <button onclick="submitRequest()" id="submit-btn"
                    class="flex-1 py-4 bg-primary text-white rounded-xl text-[11px] font-black uppercase tracking-widest shadow-lg shadow-primary/20 hover:bg-primary-dark transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                    Submit Request
                </button>
            </div>

        </main>

        <!-- BOTTOM NAVIGATION -->
        <nav class="bottom-nav">
            <a href="../dashboard.html" class="nav-item">
                <span class="material-symbols-outlined">grid_view</span>
                <span class="nav-label">Home</span>
            </a>
            <a href="../fleet.html" class="nav-item">
                <span class="material-symbols-outlined">explore</span>
                <span class="nav-label">Fleet</span>
            </a>
            <a href="../garage.html" class="nav-item active">
                <span class="material-symbols-outlined">directions_car</span>
                <span class="nav-label">Garage</span>
            </a>
            <a href="../inquiries.html" class="nav-item">
                <span class="material-symbols-outlined">forum</span>
                <span class="nav-label">Concierge</span>
            </a>
            <a href="../settings.html" class="nav-item">
                <span class="material-symbols-outlined">tune</span>
                <span class="nav-label">Settings</span>
            </a>
        </nav>
    </div>

    <!-- SUCCESS MODAL -->
    <div class="success-modal" id="success-modal">
        <div class="success-content">
            <div class="p-8 text-center">
                <div class="success-icon mb-6">
                    <span class="material-symbols-outlined text-white text-5xl">check_circle</span>
                </div>

                <h2 class="text-2xl font-[var(--font-bebas)] tracking-widest uppercase mb-2">Request Submitted!</h2>
                <p class="text-sm text-text-secondary mb-6">Your paint service request has been successfully submitted
                </p>

                <div class="bg-bg-body rounded-xl p-4 mb-6">
                    <p class="text-[9px] font-black uppercase tracking-widest text-text-secondary mb-2">Request ID</p>
                    <p class="text-lg font-bold text-primary" id="request-id">-</p>
                </div>

                <div class="space-y-2 text-left mb-6">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-green-500 text-sm">check</span>
                        <p class="text-xs text-text-secondary">manager will review within 24-48 hours</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-green-500 text-sm">check</span>
                        <p class="text-xs text-text-secondary">You'll receive a notification when quote is ready</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-green-500 text-sm">check</span>
                        <p class="text-xs text-text-secondary">Track progress in Service History</p>
                    </div>
                </div>

                <button onclick="goToServiceHistory()"
                    class="w-full py-4 bg-primary text-white rounded-xl text-sm font-bold uppercase tracking-widest hover:bg-primary-dark transition-all">
                    View Service History
                </button>
            </div>
        </div>
    </div>

    <script>
        let configData = null;
        let activeVehicle = null;

        // SLA Names
        const SLA_NAMES = {
            standard: 'Standard Service (10-14 days)',
            express: 'Express Service (7-10 days)',
            premium: 'Premium Service (7-10 days)'
        };

        const PAINT_TYPE_NAMES = {
            solid: 'Solid Color',
            metallic: 'Metallic',
            pearl: 'Pearl',
            matte: 'Matte',
            chrome: 'Chrome/Wrap'
        };

        // Initialize
        function init() {
            // Get configuration from localStorage
            const savedConfig = localStorage.getItem('paint_service_config');
            if (!savedConfig) {
                window.location.href = 'paint-service.html';
                return;
            }

            configData = JSON.parse(savedConfig);
            activeVehicle = GarageData.getVehicleById(configData.vehicleId);

            if (!activeVehicle) {
                window.location.href = '../garage.html';
                return;
            }

            renderSummary();
            setupTermsCheckbox();
        }

        function renderSummary() {
            document.getElementById('paint-type-summary').textContent = PAINT_TYPE_NAMES[configData.paintType] || configData.paintType;
            document.getElementById('sla-summary').textContent = configData.selectedSLA.charAt(0).toUpperCase() + configData.selectedSLA.slice(1);
            document.getElementById('sla-display').textContent = SLA_NAMES[configData.selectedSLA] || 'Service Level Agreement';
            document.getElementById('price-summary').textContent = GarageData.formatCurrency(configData.estimatedPrice);
        }

        function setupTermsCheckbox() {
            const checkbox = document.getElementById('terms-checkbox');
            const submitBtn = document.getElementById('submit-btn');

            submitBtn.disabled = true;

            checkbox.addEventListener('change', (e) => {
                submitBtn.disabled = !e.target.checked;
            });
        }

        function submitRequest() {
            // Create service record
            const serviceRecord = {
                vehicleId: configData.vehicleId,
                type: 'repaint',
                title: 'Full Vehicle Repaint',
                status: 'pending-review',
                createdAt: new Date().toISOString(),

                configuration: {
                    paintType: configData.paintType,
                    partColors: configData.partColors,
                    specialRequests: configData.specialRequests || ''
                },

                selectedSLA: configData.selectedSLA,
                estimatedPrice: configData.estimatedPrice,
                sla: SLA_NAMES[configData.selectedSLA],

                // To be filled by manager/partner
                partnerName: null,
                quotedPrice: null,
                approvedByUser: null,
                contractSigned: null,
                assignedAt: null,
                workStartedAt: null,
                qualityCheckAt: null,
                completedAt: null,
                verifiedAt: null,
                rating: null,
                feedback: null,

                beforeScores: {
                    beauty: 5,
                    performance: 6,
                    comfort: 5,
                    tech: 3,
                    value: activeVehicle.currentValue
                },
                afterScores: {
                    beauty: 8,
                    performance: 6,
                    comfort: 6,
                    tech: 4,
                    value: activeVehicle.currentValue + (configData.estimatedPrice * 0.3)
                },

                lineItems: [
                    {
                        name: `${PAINT_TYPE_NAMES[configData.paintType]} Paint`,
                        price: configData.estimatedPrice
                    }
                ]
            };

            // Save to localStorage (in production, this would be an API call)
            const record = GarageData.createServiceRecord(serviceRecord);

            // Clear saved config
            localStorage.removeItem('paint_service_config');
            localStorage.removeItem('paint_service_progress');

            // Show success modal with confetti
            showSuccessModal(record.id);
        }

        function showSuccessModal(requestId) {
            const modal = document.getElementById('success-modal');
            document.getElementById('request-id').textContent = requestId.toUpperCase();

            // Create confetti
            createConfetti();

            // Show modal
            modal.classList.add('active');
        }

        function createConfetti() {
            const colors = ['#00ff88', '#0088ff', '#ff0088', '#ffff00', '#ff8800'];
            const confettiCount = 50;

            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(confetti);

                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function goToServiceHistory() {
            window.location.href = 'service-history.html?vid=' + configData.vehicleId;
        }

        // Initialize on load
        init();
    </script>
</body>

</html>
