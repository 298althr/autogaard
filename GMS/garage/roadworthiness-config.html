<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Roadworthiness Certification | AutoGaard Workshop</title>
    <link rel="stylesheet" href="../css/theme.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/components.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: 'var(--primary)', 'primary-dark': 'var(--primary-dark)', 'bg-body': 'var(--bg-body)',
                        'bg-surface': 'var(--bg-surface)', 'bg-surface-elevated': 'var(--bg-surface-elevated)',
                        'text-primary': 'var(--text-primary)', 'text-secondary': 'var(--text-secondary)', 'border-color': 'var(--border-color)',
                    },
                    fontFamily: { bebas: ['Bebas Neue', 'sans-serif'], display: ['Rajdhani', 'sans-serif'], body: ['Inter', 'sans-serif'], }
                }
            }
        }
    </script>
    <script src="../js/theme.js"></script>
    <script src="js/garage-data.js"></script>
    <script src="js/registration-services.js"></script>
    <style>
        /* Fix for red screen background bleed */
        html,
        body {
            background-color: var(--bg-body) !important;
            margin: 0;
            padding: 0;
        }

        .page-wrapper {
            background-color: var(--bg-body);
        }
    </style>
</head>

<body class="bg-bg-body text-text-primary">
    <div class="page-wrapper container pb-32">
        <header class="app-header">
            <button onclick="window.history.back()" class="p-2 -ml-2"><span
                    class="material-symbols-outlined text-text-primary">arrow_back</span></button>
            <h1 class="header-title uppercase tracking-widest">Roadworthiness</h1>
            <div class="w-10"></div>
        </header>
        <main class="animate-fade-in px-gutter">
            <!-- PROGRESS -->
            <div class="flex items-center justify-center gap-2 mb-6 mt-4">
                <div class="flex items-center gap-2">
                    <div
                        class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center text-xs font-bold">
                        1</div><span
                        class="text-[9px] uppercase tracking-widest text-primary font-bold">Configure</span>
                </div>
                <div class="w-12 h-0.5 bg-border-color"></div>
                <div class="flex items-center gap-2">
                    <div
                        class="w-8 h-8 rounded-full bg-border-color text-text-secondary flex items-center justify-center text-xs font-bold">
                        2</div><span class="text-[9px] uppercase tracking-widest text-text-secondary">Review</span>
                </div>
                <div class="w-12 h-0.5 bg-border-color"></div>
                <div class="flex items-center gap-2">
                    <div
                        class="w-8 h-8 rounded-full bg-border-color text-text-secondary flex items-center justify-center text-xs font-bold">
                        3</div><span class="text-[9px] uppercase tracking-widest text-text-secondary">Submit</span>
                </div>
            </div>
            <!-- VEHICLE -->
            <div class="bg-gradient-to-br from-primary/10 to-primary/5 border border-primary/20 rounded-2xl p-5 mb-6"
                id="vehicle-card"></div>
            <!-- INSPECTION TYPE -->
            <div class="bg-bg-surface border border-border-color rounded-2xl p-5 mb-6">
                <h3 class="text-sm font-black uppercase tracking-widest mb-4">Inspection Type</h3>
                <label
                    class="flex items-center gap-3 p-3 border-2 border-border-color rounded-xl mb-3 cursor-pointer hover:border-primary transition-all">
                    <input type="radio" name="inspection-type" value="mobile" checked onchange="updateInspectionType()">
                    <div class="flex-1">
                        <p class="text-sm font-bold">Mobile Inspection (We Come to You)</p>
                        <p class="text-xs text-text-secondary">VIS inspector visits your location</p>
                    </div>
                    <span class="text-primary font-bold">+â‚¦10,000</span>
                </label>
                <label
                    class="flex items-center gap-3 p-3 border-2 border-border-color rounded-xl cursor-pointer hover:border-primary transition-all">
                    <input type="radio" name="inspection-type" value="center" onchange="updateInspectionType()">
                    <div class="flex-1">
                        <p class="text-sm font-bold">VIS Center Inspection</p>
                        <p class="text-xs text-text-secondary">You bring vehicle to VIS center</p>
                    </div>
                    <span class="text-primary font-bold">Standard</span>
                </label>
            </div>
            <!-- SCHEDULE -->
            <div class="bg-bg-surface border border-border-color rounded-2xl p-5 mb-6">
                <h3 class="text-sm font-black uppercase tracking-widest mb-4">Schedule Inspection</h3>
                <div class="space-y-3">
                    <div><label
                            class="text-[8px] font-black uppercase tracking-widest text-text-secondary block mb-1">Preferred
                            Date</label><input type="date" id="inspection-date"
                            class="w-full bg-bg-body border border-border-color rounded-xl p-3 text-sm"></div>
                    <div><label
                            class="text-[8px] font-black uppercase tracking-widest text-text-secondary block mb-1">Preferred
                            Time</label><select id="inspection-time"
                            class="w-full bg-bg-body border border-border-color rounded-xl p-3 text-sm">
                            <option>9:00 AM</option>
                            <option>10:00 AM</option>
                            <option>11:00 AM</option>
                            <option>12:00 PM</option>
                            <option>2:00 PM</option>
                            <option>3:00 PM</option>
                            <option>4:00 PM</option>
                        </select></div>
                    <div id="inspection-location-section"><label
                            class="text-[8px] font-black uppercase tracking-widest text-text-secondary block mb-1">Inspection
                            Location</label><textarea id="inspection-location" rows="2"
                            placeholder="Enter your address for mobile inspection"
                            class="w-full bg-bg-body border border-border-color rounded-xl p-3 text-sm resize-none"></textarea>
                    </div>
                </div>
            </div>
            <!-- STATE -->
            <div class="bg-bg-surface border border-border-color rounded-2xl p-5 mb-6">
                <h3 class="text-sm font-black uppercase tracking-widest mb-4">State</h3>
                <div id="state-selector"></div>
            </div>
            <!-- REPAIRS -->
            <div class="bg-bg-surface border border-border-color rounded-2xl p-5 mb-6">
                <h3 class="text-sm font-black uppercase tracking-widest mb-4">Repairs (If Needed)</h3>
                <label class="flex items-start gap-3 cursor-pointer"><input type="checkbox" id="approve-repairs"
                        class="mt-1">
                    <div class="flex-1">
                        <p class="text-sm font-bold">Authorize Repairs if Inspection Fails</p>
                        <p class="text-xs text-text-secondary">We'll fix any issues and re-inspect</p>
                    </div>
                </label>
            </div>
            <!-- DOCUMENTS -->
            <div class="bg-bg-surface border border-border-color rounded-2xl p-5 mb-6" id="document-upload"></div>
            <!-- PRICING -->
            <div class="bg-gradient-to-br from-primary/10 to-primary/5 border border-primary/20 rounded-2xl p-5 mb-6"
                id="pricing-breakdown"></div>
            <button onclick="proceedToReview()"
                class="w-full py-4 bg-primary text-white rounded-xl text-sm font-black uppercase tracking-widest shadow-lg shadow-primary/20 hover:bg-primary-dark transition-all">Proceed
                to Review</button>
        </main>
        <nav class="bottom-nav">
            <a href="../dashboard.html" class="nav-item"><span class="material-symbols-outlined">grid_view</span><span
                    class="nav-label">Home</span></a>
            <a href="../fleet.html" class="nav-item"><span class="material-symbols-outlined">explore</span><span
                    class="nav-label">Fleet</span></a>
            <a href="../garage.html" class="nav-item active"><span
                    class="material-symbols-outlined">directions_car</span><span class="nav-label">Garage</span></a>
            <a href="../inquiries.html" class="nav-item"><span class="material-symbols-outlined">forum</span><span
                    class="nav-label">Concierge</span></a>
            <a href="../settings.html" class="nav-item"><span class="material-symbols-outlined">tune</span><span
                    class="nav-label">Settings</span></a>
        </nav>
    </div>
    <script>
        let activeVehicle = null;
        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            const vid = urlParams.get('vid') || GarageData.getActiveVehicle()?.id;
            activeVehicle = GarageData.getVehicleById(vid);
            if (!activeVehicle) { window.location.href = 'select-vehicle.html?service=roadworthiness'; return; }
            RegistrationServices.renderVehicleCard(activeVehicle, 'vehicle-card');
            RegistrationServices.renderStateSelector('state-selector', 'lagos');
            RegistrationServices.renderDocumentUpload('document-upload', ['vehicle-license', 'owner-id', 'insurance']);
            const tomorrow = new Date(); tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('inspection-date').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('inspection-date').min = tomorrow.toISOString().split('T')[0];
            loadProgress(); updatePricing();
            document.addEventListener('input', saveProgress); document.addEventListener('change', saveProgress);
        }
        function updateInspectionType() {
            const type = document.querySelector('input[name="inspection-type"]:checked')?.value;
            const locationSection = document.getElementById('inspection-location-section');
            locationSection.style.display = type === 'mobile' ? 'block' : 'none';
            updatePricing();
        }
        function updatePricing() {
            const state = document.getElementById('state-select')?.value || 'lagos';
            const stateData = RegistrationServices.STATES[state];
            const inspectionType = document.querySelector('input[name="inspection-type"]:checked')?.value || 'mobile';
            const fees = { governmentFees: stateData.fees.roadworthiness, serviceFee: 25000, mobileInspectionFee: inspectionType === 'mobile' ? 10000 : 0, repairsCost: 0, total: 0 };
            fees.total = fees.governmentFees + fees.serviceFee + fees.mobileInspectionFee + fees.repairsCost;
            RegistrationServices.renderFeeBreakdown('pricing-breakdown', fees);
        }
        function saveProgress() {
            const config = { vehicleId: activeVehicle.id, inspectionType: document.querySelector('input[name="inspection-type"]:checked')?.value || 'mobile', inspectionDate: document.getElementById('inspection-date')?.value || '', inspectionTime: document.getElementById('inspection-time')?.value || '9:00 AM', inspectionLocation: document.getElementById('inspection-location')?.value || '', state: document.getElementById('state-select')?.value || 'lagos', approveRepairs: document.getElementById('approve-repairs')?.checked || false };
            RegistrationServices.saveProgress('roadworthiness', config);
        }
        function loadProgress() {
            const saved = RegistrationServices.loadProgress('roadworthiness');
            if (!saved) return;
            if (saved.inspectionType) { const radio = document.querySelector(`input[name="inspection-type"][value="${saved.inspectionType}"]`); if (radio) { radio.checked = true; updateInspectionType(); } }
            if (saved.inspectionDate) document.getElementById('inspection-date').value = saved.inspectionDate;
            if (saved.inspectionTime) document.getElementById('inspection-time').value = saved.inspectionTime;
            if (saved.inspectionLocation) document.getElementById('inspection-location').value = saved.inspectionLocation;
            if (saved.state) document.getElementById('state-select').value = saved.state;
            if (saved.approveRepairs !== undefined) document.getElementById('approve-repairs').checked = saved.approveRepairs;
            updatePricing();
        }
        function proceedToReview() {
            const inspectionDate = document.getElementById('inspection-date').value;
            const inspectionType = document.querySelector('input[name="inspection-type"]:checked')?.value;
            if (!inspectionDate) { RegistrationServices.showToast('Please select inspection date', 'error'); return; }
            if (inspectionType === 'mobile' && !document.getElementById('inspection-location').value) { RegistrationServices.showToast('Please enter inspection location', 'error'); return; }
            const validation = RegistrationServices.validateDocuments(['vehicle-license', 'owner-id', 'insurance']);
            if (!validation.valid) { RegistrationServices.showToast(`Missing documents: ${validation.missing.join(', ')}`, 'error'); return; }
            saveProgress();
            window.location.href = `roadworthiness-review.html?vid=${activeVehicle.id}`;
        }
        init();
    </script>
</body>

</html>
